# ========================================
# üéØ CONFIGURA√á√ÉO OTIMIZADA PARA FREE TIER
# ========================================
# Este arquivo cont√©m configura√ß√µes otimizadas para CUSTOS M√çNIMOS
# Recursos eleg√≠veis para AWS Free Tier est√£o marcados com ‚úÖ
#
# üìñ Para detalhes completos, veja: FREE_TIER_OPTIMIZATION.md
#
# Custo estimado com estas configura√ß√µes: ~$35-50/m√™s (60-70% economia)
# ========================================

# Configura√ß√µes Gerais
project_name = "case-tec"
environment  = "dev"
region       = "us-east-1"

# Tags para Cost Allocation
tags = {
  Team       = "DataEngineering"
  CostCenter = "Engineering"
  ManagedBy  = "Terraform"
}

# ========================================
# S3 Configuration (otimizado para FREE TIER)
# ========================================
# FREE TIER: 5GB de armazenamento Standard
# FREE TIER: 20,000 GET requests/m√™s
# FREE TIER: 2,000 PUT requests/m√™s
# PERMANENTE (n√£o expira ap√≥s 12 meses!)
s3_enable_versioning         = false # ‚úÖ Desabilitado em dev (economiza 50% storage)
s3_enable_lifecycle          = true  # Mover dados para classes mais baratas
s3_lifecycle_days_to_ia      = 30    # ‚ö†Ô∏è M√çNIMO 30 dias (requisito AWS para Standard-IA)
s3_lifecycle_days_to_glacier = 60    # ‚úÖ 60 dias para Glacier (85% mais barato)
s3_lifecycle_days_to_expire  = 365   # ‚úÖ Deletar ap√≥s 1 ano (0 = nunca expirar)

# ========================================
# RDS Configuration (otimizado para FREE TIER)
# ========================================
# ‚ö†Ô∏è NOTA: Aurora foi SUBSTITU√çDO por RDS PostgreSQL tradicional
# 
# FREE TIER (v√°lido por 12 meses):
# ‚úÖ 750 horas/m√™s de db.t3.micro, db.t2.micro ou db.t4g.micro
# ‚úÖ 20 GB de armazenamento SSD (General Purpose)
# ‚úÖ 20 GB de backups e snapshots
# 
# Ap√≥s 12 meses: ~$12-15/m√™s (ainda muito mais barato que Aurora ~$62/m√™s)
aurora_engine                       = "aurora-postgresql"          # Ser√° convertido para "postgres"
aurora_engine_version               = ""                           # Deixe vazio para vers√£o mais recente
aurora_instance_class               = "db.t3.micro"                # ‚úÖ FREE TIER eleg√≠vel
aurora_instance_count               = 1                            # Inst√¢ncia √∫nica
aurora_allocated_storage            = 20                           # ‚úÖ FREE TIER: 20GB
aurora_max_allocated_storage        = 0                            # Desabilitado (sem autoscaling)
aurora_database_name                = "datawarehouse"
aurora_master_username              = "masteruser"
aurora_master_password              = "CHANGE_ME_USE_SECRETS_MANAGER" # ‚ö†Ô∏è Use AWS Secrets Manager!
aurora_backup_retention_period      = 1                            # ‚úÖ FREE TIER: 1 dia incluso
aurora_preferred_backup_window      = "03:00-04:00"
aurora_preferred_maintenance_window = "mon:04:00-mon:05:00"
aurora_skip_final_snapshot          = true                         # false para produ√ß√£o
aurora_allow_external_access        = false                        # RDS em subnet privada
aurora_external_access_cidr_blocks  = []                           # Sem acesso direto externo

# ========================================
# Bastion Host Configuration (‚úÖ FREE TIER)
# ========================================
# FREE TIER: 750 horas/m√™s de t2.micro ou t3.micro (12 meses)
# Para acesso seguro ao RDS via SSH tunnel
bastion_ssh_public_key = ""  # ‚ö†Ô∏è OBRIGAT√ìRIO: Cole sua chave SSH p√∫blica aqui
# Exemplo: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQ... seu-email@example.com

bastion_allowed_ssh_cidr_blocks = ["0.0.0.0/0"]  
# ‚ö†Ô∏è IMPORTANTE: Substitua por seu IP p√∫blico para seguran√ßa:
# Exemplo: ["203.0.113.42/32"]  # Apenas seu IP
# Para obter seu IP: curl ifconfig.me

# ========================================
# VPC Configuration (otimizado para dev)
# ========================================
# OTIMIZA√á√ÉO: 2 AZs + 1 NAT Gateway em dev (economia ~$116/m√™s vs 3 AZs + 3 NAT)
# Produ√ß√£o: 3 AZs + 3 NAT Gateways (alta disponibilidade)
create_vpc         = true
vpc_cidr           = "10.0.0.0/16"
vpc_id             = ""  # Use apenas se create_vpc = false
availability_zones = []  # Deixe vazio: 2 AZs em dev, 3 AZs em prod

# ========================================
# Glue Jobs Configuration
# ========================================
# ‚ö†Ô∏è IMPORTANTE: G.025X s√≥ funciona para Glue Streaming jobs
# Para ETL jobs, o m√≠nimo √© G.1X (1 DPU por worker)
#
# CONFIGURA√á√ÉO:
# - 2 workers √ó G.1X = 2 DPU total
# - Custo: 2 DPU √ó $0.44/h = $0.88/hora
#
# NOTA: Os script_locations ser√£o ajustados automaticamente pelo Terraform
glue_jobs = {
  "etl-pipeline" = {
    script_location   = "s3://case-tec-dev-scripts-PLACEHOLDER/scripts/etl_pipeline.py"
    python_version    = "3"
    glue_version      = "4.0"
    worker_type       = "G.1X"    # 1 DPU/worker (m√≠nimo para ETL)
    number_of_workers = 2         # Total: 2 √ó 1 = 2 DPU
    timeout           = 2880      # minutos (48 horas)
  }
  # Adicione mais jobs conforme necess√°rio
  # "outro-job" = {
  #   script_location   = "s3://case-tec-dev-scripts-PLACEHOLDER/scripts/outro_job.py"
  #   python_version    = "3"
  #   glue_version      = "4.0"
  #   worker_type       = "G.1X"
  #   number_of_workers = 2
  #   timeout           = 2880
  # }
}

# ========================================
# Glue Crawlers Configuration
# ========================================
# NOTA: Paths S3 ser√£o substitu√≠dos automaticamente pelo Terraform
glue_crawlers = {
  "raw-data-crawler" = {
    s3_paths = [
      "s3://case-tec-dev-raw-PLACEHOLDER/",  # Substitu√≠do automaticamente
    ]
    database_name = "raw_data"  # Deixe vazio para usar database padr√£o
    schema_change_policy = {
      update_behavior = "UPDATE_IN_DATABASE"
      delete_behavior = "LOG"
    }
  }
  "processed-data-crawler" = {
    s3_paths = [
      "s3://case-tec-dev-processed-PLACEHOLDER/",  # Substitu√≠do automaticamente
    ]
    database_name = "processed_data"
    schema_change_policy = {
      update_behavior = "UPDATE_IN_DATABASE"
      delete_behavior = "LOG"
    }
  }
}

# ========================================
# üìñ DOCUMENTA√á√ÉO ADICIONAL
# ========================================
# 
# FREE_TIER_OPTIMIZATION.md  ‚Üí Detalhes completos de otimiza√ß√£o
# COST_OPTIMIZATION.md       ‚Üí Otimiza√ß√£o de VPC (AZs e NAT)
# ANALYTICS_GUIDE.md         ‚Üí Guia de queries anal√≠ticas
# README.md                  ‚Üí Overview do projeto
#
# ========================================
# üí∞ CUSTO ESTIMADO (DEV)
# ========================================
# 
# RDS db.t3.micro:            ‚úÖ $0 (FREE TIER 12 meses)
# Bastion t3.micro:           ‚úÖ $0 (FREE TIER 12 meses)
# S3 (<5GB):                  ‚úÖ $0 (FREE TIER permanente)
# VPC Endpoint S3:            ‚úÖ $0 (Gateway = gr√°tis)
# NAT Gateway:                ~$32/m√™s (inevit√°vel)
# NAT Data Transfer:          ~$2-5/m√™s (reduzido com VPC Endpoint)
# Glue Jobs (sob demanda):    ~$0-10/m√™s (depende de execu√ß√µes)
# CloudWatch Logs (<5GB):     ‚úÖ $0 (FREE TIER)
# 
# TOTAL: ~$35-50/m√™s
# ECONOMIA vs configura√ß√£o original: 60-70% (~$70-110/m√™s)
# 
# ========================================
# ‚ö†Ô∏è IMPORTANTE
# ========================================
# 
# 1. Free Tier RDS/EC2 √© v√°lido por 12 MESES ap√≥s criar conta AWS
# 2. Ap√≥s 12 meses, RDS db.t3.micro custa ~$12-15/m√™s (ainda barato!)
# 3. S3 Free Tier √© PERMANENTE (n√£o expira)
# 4. NAT Gateway N√ÉO tem Free Tier ($32/m√™s inevit√°vel)
# 5. SEMPRE use AWS Secrets Manager para senhas em produ√ß√£o
# 6. SEMPRE restrinja bastion_allowed_ssh_cidr_blocks ao seu IP
# 7. SEMPRE configure AWS Budgets para alertas de custo
# 
# ========================================
